<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SS3 Intelligence Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body { 
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
      color: #e0e0e0; 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      text-align: center;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: rgba(25, 25, 35, 0.95);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 1px solid #333;
    }
    
    h1 { 
      color: #00ffcc;
      text-shadow: 0 0 10px #00ffcc;
      margin-bottom: 10px;
      font-size: 2.5em;
    }
    
    .subtitle {
      color: #888;
      margin-bottom: 30px;
      font-size: 1.1em;
    }
    
    .input-group {
      margin: 30px 0;
    }
    
    input { 
      padding: 15px; 
      width: 100%;
      max-width: 500px;
      border: 1px solid #00ffff;
      background: #111; 
      color: #00ffff;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s;
    }
    
    input:focus {
      outline: none;
      box-shadow: 0 0 15px #00ffff;
      border-color: #00ffcc;
    }
    
    input::placeholder {
      color: #666;
    }
    
    .button-group {
      margin: 20px 0;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    button { 
      padding: 12px 25px; 
      background: #00ffcc; 
      color: #0a0a0a; 
      border: none; 
      cursor: pointer;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s;
      min-width: 150px;
    }
    
    button:hover {
      background: #00ffff;
      box-shadow: 0 0 15px #00ffff;
      transform: translateY(-2px);
    }
    
    button:disabled {
      background: #555;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }
    
    .secondary-btn {
      background: transparent;
      border: 2px solid #00ffcc;
      color: #00ffcc;
    }
    
    .secondary-btn:hover {
      background: #00ffcc;
      color: #0a0a0a;
    }
    
    .output-container {
      position: relative;
      margin: 20px 0;
    }
    
    pre { 
      text-align: left; 
      margin: 20px auto; 
      background: #111; 
      padding: 20px; 
      border-radius: 8px;
      border: 1px solid #00ffff;
      min-height: 200px;
      max-height: 500px;
      overflow-y: auto;
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
      font-size: 14px;
    }
    
    .loading {
      display: none;
      color: #00ffcc;
      margin: 20px 0;
      padding: 15px;
      background: rgba(0, 255, 204, 0.1);
      border-radius: 8px;
      border: 1px solid #00ffcc;
    }
    
    .spinner {
      border: 3px solid #333;
      border-top: 3px solid #00ffcc;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .status-bar {
      margin: 15px 0;
      padding: 12px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      border-left: 4px solid #00ffcc;
      text-align: left;
    }
    
    .reports-section {
      margin: 30px 0;
      padding: 20px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 10px;
      border: 1px solid #333;
    }
    
    .reports-list {
      text-align: left;
      margin: 15px 0;
      max-height: 200px;
      overflow-y: auto;
      background: #111;
      padding: 15px;
      border-radius: 8px;
    }
    
    .report-item {
      padding: 10px;
      border-bottom: 1px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .report-item:last-child {
      border-bottom: none;
    }
    
    .report-actions {
      display: flex;
      gap: 10px;
    }
    
    .action-btn {
      padding: 5px 10px;
      font-size: 12px;
      min-width: auto;
      background: #333;
      color: #00ffcc;
    }
    
    .action-btn:hover {
      background: #00ffcc;
      color: #0a0a0a;
    }
    
    .success { color: #00ff00; border-left-color: #00ff00; }
    .error { color: #ff4444; border-left-color: #ff4444; }
    .warning { color: #ffff00; border-left-color: #ffff00; }
    .info { color: #00ffff; border-left-color: #00ffff; }
    
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      h1 {
        font-size: 2em;
      }
      
      .button-group {
        flex-direction: column;
      }
      
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ›¡ï¸ SS3 Intelligence Dashboard</h1>
    <div class="subtitle">GÃ¼venlik Analiz ve Ä°stihbarat Platformu</div>
    
    <div class="input-group">
      <input type="text" id="target" placeholder="Hedef domain veya IP girin... (Ã¶rnek: example.com veya 192.168.1.1)" autocomplete="off">
    </div>

    <div class="button-group">
      <button onclick="runSS3()" id="analyzeBtn">Analiz BaÅŸlat</button>
      <button onclick="loadReports()" id="reportsBtn" class="secondary-btn">RaporlarÄ± YÃ¼kle</button>
      <button onclick="clearOutput()" id="clearBtn" class="secondary-btn">EkranÄ± Temizle</button>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <span>Analiz yapÄ±lÄ±yor, lÃ¼tfen bekleyin... Bu iÅŸlem birkaÃ§ dakika sÃ¼rebilir.</span>
    </div>

    <div class="status-bar info" id="status">
      Sistem hazÄ±r. Analiz baÅŸlatmak iÃ§in hedef girin.
    </div>

    <div class="reports-section" id="reportsSection" style="display: none;">
      <h3>ğŸ“‹ Mevcut Raporlar</h3>
      <div class="reports-list" id="reportsList">
        <!-- Raporlar buraya yÃ¼klenecek -->
      </div>
    </div>

    <div class="output-container">
      <pre id="output">SS3 Intelligence Dashboard'a hoÅŸ geldiniz!

ğŸ¯ Ã–zellikler:
â€¢ Hedef domain/IP analizi
â€¢ KapsamlÄ± gÃ¼venlik taramasÄ±
â€¢ Otomatik rapor oluÅŸturma
â€¢ DetaylÄ± risk deÄŸerlendirmesi

ğŸ“ KullanÄ±m:
1. YukarÄ±daki alana hedef domain veya IP adresini girin
2. "Analiz BaÅŸlat" butonuna tÄ±klayÄ±n
3. SonuÃ§larÄ± bekleyin ve raporlarÄ± inceleyin

âš ï¸  Not: Analiz iÅŸlemi hedefin karmaÅŸÄ±klÄ±ÄŸÄ±na gÃ¶re birkaÃ§ dakika sÃ¼rebilir.</pre>
    </div>
  </div>

  <script>
    let currentReports = [];

    async function runSS3() {
      const target = document.getElementById('target').value.trim();
      const output = document.getElementById('output');
      const loading = document.getElementById('loading');
      const analyzeBtn = document.getElementById('analyzeBtn');
      const status = document.getElementById('status');

      // Validasyon
      if (!target) {
        showStatus('âŒ Hata: LÃ¼tfen bir hedef domain veya IP adresi girin.', 'error');
        return;
      }

      // Domain/IP validasyonu
      if (!isValidTarget(target)) {
        showStatus('âŒ Hata: GeÃ§erli bir domain veya IP adresi girin.', 'error');
        return;
      }

      // UI durumunu gÃ¼ncelle
      analyzeBtn.disabled = true;
      analyzeBtn.textContent = "Analiz YapÄ±lÄ±yor...";
      loading.style.display = 'block';
      showStatus(`Hedef: ${target} | Durum: Analiz baÅŸlatÄ±lÄ±yor...`, 'info');
      output.textContent = "Analiz baÅŸlatÄ±lÄ±yor... LÃ¼tfen bekleyin.";

      try {
        const response = await fetch('/run', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ target: target })
        });

        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || `Sunucu hatasÄ±: ${response.status}`);
        }

        // BaÅŸarÄ±lÄ± yanÄ±t
        showStatus(`Hedef: ${target} | Durum: TamamlandÄ± âœ…`, 'success');
        output.textContent = data.message || "Analiz baÅŸarÄ±yla tamamlandÄ±.";
        
        // RaporlarÄ± otomatik yenile
        await loadReports();

      } catch (error) {
        // Hata durumu
        console.error('Hata:', error);
        showStatus(`Hedef: ${target} | Durum: Hata âŒ`, 'error');
        output.textContent = `âŒ Ä°stek sÄ±rasÄ±nda hata oluÅŸtu:\n${error.message}\n\nğŸ”§ Sorun Giderme:\nâ€¢ Sunucunun Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun\nâ€¢ Ä°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edin\nâ€¢ Hedefin geÃ§erli olduÄŸundan emin olun`;
      } finally {
        // UI durumunu sÄ±fÄ±rla
        analyzeBtn.disabled = false;
        analyzeBtn.textContent = "Analiz BaÅŸlat";
        loading.style.display = 'none';
      }
    }

    async function loadReports() {
      const reportsSection = document.getElementById('reportsSection');
      const reportsList = document.getElementById('reportsList');
      const reportsBtn = document.getElementById('reportsBtn');

      try {
        reportsBtn.disabled = true;
        reportsBtn.textContent = "YÃ¼kleniyor...";
        
        const response = await fetch('/reports');
        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Raporlar yÃ¼klenemedi');
        }

        currentReports = data.reports || [];
        
        if (currentReports.length === 0) {
          reportsList.innerHTML = '<div class="report-item">HenÃ¼z rapor bulunmuyor</div>';
        } else {
          reportsList.innerHTML = currentReports.map(report => `
            <div class="report-item">
              <div>
                <strong>${report.filename}</strong><br>
                <small>OluÅŸturulma: ${report.created_time}</small>
              </div>
              <div class="report-actions">
                <button class="action-btn" onclick="viewReport('${report.filename}')">GÃ¶rÃ¼ntÃ¼le</button>
                <button class="action-btn" onclick="downloadReport('${report.filename}')">Ä°ndir</button>
              </div>
            </div>
          `).join('');
        }
        
        reportsSection.style.display = 'block';
        showStatus(`ğŸ“Š ${currentReports.length} rapor yÃ¼klendi`, 'success');

      } catch (error) {
        console.error('Rapor yÃ¼kleme hatasÄ±:', error);
        showStatus(`âŒ Raporlar yÃ¼klenemedi: ${error.message}`, 'error');
        reportsList.innerHTML = '<div class="report-item">Raporlar yÃ¼klenirken hata oluÅŸtu</div>';
        reportsSection.style.display = 'block';
      } finally {
        reportsBtn.disabled = false;
        reportsBtn.textContent = "RaporlarÄ± YÃ¼kle";
      }
    }

    function viewReport(filename) {
      window.open(`/view/${filename}`, '_blank');
    }

    function downloadReport(filename) {
      window.location.href = `/download/${filename}`;
    }

    function clearOutput() {
      document.getElementById('output').textContent = '';
      showStatus('Ekran temizlendi. Yeni analiz baÅŸlatabilirsiniz.', 'info');
    }

    function showStatus(message, type = 'info') {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = `status-bar ${type}`;
    }

    function isValidTarget(target) {
      // Domain validasyonu
      const domainRegex = /^[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z]{2,})+$/;
      // IP validasyonu
      const ipRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
      
      return domainRegex.test(target) || ipRegex.test(target);
    }

    // Enter tuÅŸu ile analiz baÅŸlatma
    document.getElementById('target').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        runSS3();
      }
    });

    // Sayfa yÃ¼klendiÄŸinde raporlarÄ± otomatik yÃ¼kle
    window.addEventListener('load', function() {
      document.getElementById('target').focus();
      loadReports();
    });

    // Input deÄŸiÅŸikliklerinde validasyon
    document.getElementById('target').addEventListener('input', function(e) {
      const target = e.target.value.trim();
      if (target && !isValidTarget(target)) {
        e.target.style.borderColor = '#ff4444';
      } else {
        e.target.style.borderColor = target ? '#00ff00' : '#00ffff';
      }
    });
  </script>
</body>
</html>
